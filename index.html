<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()"/>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="An interactive guitar fretboard diagram.">
    <meta name="keywords" content="guitar, music">
    <meta name="author" content="Mika Kutila">
    <title>Fretboard</title>
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <style>
      :root {
        --bg:#ffffff;
        --text:#222;
        --heading:#333;
        --panel-bg:#f8f8f8;
        --panel-border:#ccc;
        --muted:#666;
        --divider1:#ddd; --divider2:#eee;
        --button-bg1:#ffffff; --button-bg2:#f0f0f0; --button-bg-hover2:#e8e8e8;
        --focus-ring: 0 0 0 3px rgba(0,123,255,0.35);
      }
      body.dark {
        --bg:#101418;
        --text:#e2e6ea;
        --heading:#fafbfc;
        --panel-bg:#1d2329;
        --panel-border:#3a444e;
        --muted:#8a96a3;
        --divider1:#2c343c; --divider2:#1f262c;
        --button-bg1:#262f37; --button-bg2:#1f272e; --button-bg-hover2:#273039;
        --focus-ring: 0 0 0 3px rgba(120,180,255,0.4);
      }
      /* Fret number theming */
      .fret-numbers { fill:#111; }
      body.dark .fret-numbers { fill:#fafbfc; }
      body { font-family: system-ui, Arial, sans-serif; margin:18px; line-height:1.35; background:var(--bg); color:var(--text); transition: background .25s, color .25s; }
      h2 { margin-top:0; color:var(--heading); }
      /* Reserve space to avoid CLS when header text injected */
      #fretboardHeader { min-height:1.6em; }
      #fretboard_container { margin-bottom:16px; }
      #controlArea { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px; align-items:start; margin-top:12px; }
      .panel { background:var(--panel-bg); border:1px solid var(--panel-border); border-radius:8px; padding:12px 14px 14px; box-shadow:0 1px 2px rgba(0,0,0,0.08); transition: background .25s, border-color .25s; }
      .panel h4 { margin:0 0 8px; font-size:1rem; letter-spacing:.5px; text-transform:uppercase; font-weight:600; color:var(--heading); }
      .panel label { cursor:pointer; }
      fieldset { border:none; padding:0; margin:0; }
      fieldset legend { font-weight:600; margin-bottom:4px; }
      .inline-radio label { display:flex; align-items:center; gap:4px; margin:2px 0; }
      #zoomControls { display:flex; align-items:center; gap:6px; margin:4px 0 0; }
      #zoomControls button { width:2.2em; height:2.2em; font-size:1rem; }
      #zoomLevelDisplay { font-variant-numeric:tabular-nums; }
      .number-input-row { display:flex; align-items:center; gap:6px; margin-top:6px; }
      .muted { color:var(--muted); font-size:.75rem; }
      .divider { height:1px; background:linear-gradient(90deg,var(--divider1),var(--divider2),var(--divider1)); margin:8px 0 10px; border:none; }
      .stretch { width:100%; }
      .actions-row { display:flex; gap:8px; margin-top:6px; }
      button, input[type=number], select { border:1px solid var(--panel-border); border-radius:4px; padding:4px 6px; background:linear-gradient(var(--button-bg1),var(--button-bg2)); color:var(--text); transition: background .2s, color .2s, border-color .2s; }
      button:hover { background:linear-gradient(var(--button-bg1),var(--button-bg-hover2)); }
      button:focus, input:focus, select:focus { outline:none; box-shadow:var(--focus-ring); }
      #themeToggleBtn { padding:6px 10px; font-size:.85rem; }
      #pageFooter { margin:40px 0 12px; text-align:center; }
      @media (max-width:560px){ #controlArea { grid-template-columns:1fr; } }
    </style>
    <!-- Pre-size fretboard container (Option A CLS mitigation) -->
    <script>
      (function(){
        var zMin=0.4, zMax=1.6, z=1.0;
        try {
          var raw = localStorage.getItem('zoomLevel');
            if(raw!==null){ var p=parseFloat(raw); if(!isNaN(p)) z = Math.min(zMax, Math.max(zMin, p)); }
        } catch {}
        var BASE_G_WIDTH=500, BASE_G_HEIGHT=200, BASE_PADDING=60;
        var cw = Math.round(z * (BASE_G_WIDTH + BASE_PADDING));
        var ch = Math.round(z * (BASE_G_HEIGHT + 2*BASE_PADDING));
        var styleEl = document.createElement('style');
        // Reserve exact space; width unaffected by dynamic fret count in current layout logic
        styleEl.textContent = '#fretboard_container{width:'+cw+'px;height:'+ch+'px;display:block;}';
        document.head.appendChild(styleEl);
      })();
    </script>
</head>
<body>
    <h2 id="fretboardHeader">&nbsp;</h2>
    <div id="fretboard_container"></div>

    <div id="controlArea" aria-label="Fretboard controls">
      <div class="panel" aria-labelledby="panel-highlight">
        <h4 id="panel-highlight">Highlight & Base</h4>
        <label for="baseNoteSelectDropdown" class="muted" style="font-size:.7rem; letter-spacing:.5px; text-transform:uppercase; font-weight:600;">Base Note</label>
        <select id="baseNoteSelectDropdown" class="stretch" aria-label="Select base note" style="margin:4px 0 10px;">
          <option value="C">C</option>
          <option value="C#">C#</option>
          <option value="D">D</option>
          <option value="D#">D#</option>
          <option value="E">E</option>
          <option value="F">F</option>
          <option value="F#">F#</option>
          <option value="G">G</option>
          <option value="G#">G#</option>
          <option value="A">A</option>
          <option value="A#">A#</option>
          <option value="B">B</option>
        </select>
        <label for="highlightModeSelect" class="muted" style="font-size:.7rem; letter-spacing:.5px; text-transform:uppercase; font-weight:600;">Highlight Mode</label>
        <select id="highlightModeSelect" class="stretch" aria-label="Select highlight mode" style="margin:4px 0 6px;">
          <option value="NONE">None</option>
          <option value="BASENOTE" selected>Basenote</option>
          <option value="PENTATONIC_SCALE">Pentatonic Scale</option>
          <option value="MAJOR_SCALE">Major Scale</option>
          <option value="NATURAL_MINOR_SCALE">Natural Minor Scale</option>
          <option value="MAJOR_CHORD">Major Chord</option>
          <option value="MINOR_CHORD">Minor Chord</option>
          <option value="DOMINANT_SEVEN_CHORD">7 Chord</option>
          <option value="MAJOR_SEVEN_CHORD">Maj7 Chord</option>
          <option value="MINOR_SEVEN_CHORD">m7 Chord</option>
          <option value="POWER_CHORD">Power Chord</option>
        </select>
        <div class="muted" style="font-size:.7rem; letter-spacing:.5px; text-transform:uppercase; font-weight:600; margin-top:6px;">Highlight List</div>
        <div style="margin:4px 0 8px; font-size:.85rem;">
          <label><input type="radio" name="highlightSet" value="BASIC" checked> Basic</label>
          <label style="margin-left:10px;"><input type="radio" name="highlightSet" value="ADVANCED"> Advanced</label>
        </div>
        <div class="muted" style="font-size:.65rem;">Advanced adds extended / altered chords & scales.</div>
      </div>

      <!-- Layout panel second -->
      <div class="panel" aria-labelledby="panel-base">
        <h4 id="panel-base">Layout</h4>
        <hr class="divider" />
        <div id="zoomControls" aria-label="Zoom controls">
          <button id="zoomOutBtn" title="Zoom out" aria-label="Zoom out">-</button>
          <span id="zoomLevelDisplay" aria-live="polite"></span>
          <button id="zoomInBtn" title="Zoom in" aria-label="Zoom in">+</button>
        </div>
        <div class="number-input-row">
          <label for="fretCountInput">Frets:</label>
          <input type="number" id="fretCountInput" min="2" max="21" value="12" />
          <span class="muted">2â€“21</span>
        </div>
      </div>

      <div class="panel" aria-labelledby="panel-visibility">
        <h4 id="panel-visibility">Visibility</h4>
        <label><input type="checkbox" id="noteNamesCheckbox" checked /> Show Notes</label><br />
        <label><input type="checkbox" id="intervalNamesCheckbox" checked /> Show Intervals</label>
      </div>

      <div class="panel" aria-labelledby="panel-legend">
        <h4 id="panel-legend">Legend</h4>
        <p class="muted" style="margin:0 0 6px;">Colors / intervals update with base note and highlight mode.</p>
        <ul class="muted" style="padding-left:16px; margin:0; list-style:disc;">
          <li>Click fretboard to shift base note.</li>
          <li>Change Frets to resize neck.</li>
          <li>Zoom resets layout for clarity.</li>
        </ul>
      </div>
    </div>

    <footer id="pageFooter" aria-label="Theme toggle">
      <button id="themeToggleBtn" type="button" aria-pressed="false" title="Toggle dark / light theme">Dark Theme</button>
    </footer>

    <script>
      (function(){
        const KEY='theme';
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        let storedRaw = localStorage.getItem(KEY);
        let stored;
        try { stored = storedRaw === null ? null : JSON.parse(storedRaw); } catch { stored = storedRaw; }
        if (stored === 'dark' || (!stored && prefersDark)) {
          document.body.classList.add('dark');
        }
        function persist(val){ try { localStorage.setItem(KEY, JSON.stringify(val)); } catch {} }
        function updateLabel(){
          const btn=document.getElementById('themeToggleBtn'); if(!btn) return;
          const dark = document.body.classList.contains('dark');
          btn.textContent = dark ? 'Light Theme' : 'Dark Theme';
          btn.setAttribute('aria-pressed', dark?'true':'false');
        }
        document.getElementById('themeToggleBtn').addEventListener('click',()=>{
          const willBeDark = !document.body.classList.contains('dark');
            document.body.classList.toggle('dark');
            persist(willBeDark ? 'dark' : 'light');
            updateLabel();
        });
        updateLabel();
      })();
    </script>
    <script type="module" src="js/guitarneck.js"></script>
</body>
</html>